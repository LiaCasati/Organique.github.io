/* organico_logico: */

CREATE TABLE USUARIO (
    nome varchar(255),
    status varchar(255),
    cpf int,
    id serial PRIMARY KEY,
    cep int,
    n_casa int,
    complemento varchar(255)
);

CREATE TABLE PRODUTO (
    id serial PRIMARY KEY,
    nome varchar(255),
    preco float,
    validade date,
    FK_MARCA_id serial,
    FK_CATEGORIA_id serial
);

CREATE TABLE ITEM (
    qtd int,
    id serial PRIMARY KEY,
    FK_COMPRA_id serial
);

CREATE TABLE MARCA (
    id serial PRIMARY KEY,
    nome varchar(255)
);

CREATE TABLE COMPRA (
    id serial PRIMARY KEY,
    data date,
    status varchar(255),
    FK_USUARIO_id serial
);

CREATE TABLE CATEGORIA (
    id serial PRIMARY KEY,
    nome varchar(255)
);

CREATE TABLE RESTRICAO (
    id serial PRIMARY KEY,
    tipo varchar(255)
);

CREATE TABLE CONTATO (
    id serial PRIMARY KEY,
    contato varchar(255),
    FK_USUARIO_id serial,
    FK_TIPO_CONT_id serial
);

CREATE TABLE TIPO_CONT (
    id serial PRIMARY KEY,
    tipo varchar(255)
);

CREATE TABLE COMENTARIO (
    id serial PRIMARY KEY,
    descricao varchar(255),
    FK_USUARIO_id serial,
    FK_PRODUTO_id serial
);

CREATE TABLE prod_restricao (
    fk_RESTRICAO_id serial,
    fk_PRODUTO_id serial
);

CREATE TABLE item_prod (
    fk_PRODUTO_id serial,
    fk_ITEM_id serial
);
 
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO_2
    FOREIGN KEY (FK_MARCA_id)
    REFERENCES MARCA (id)
    ON DELETE RESTRICT;
 
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO_3
    FOREIGN KEY (FK_CATEGORIA_id)
    REFERENCES CATEGORIA (id)
    ON DELETE RESTRICT;
 
ALTER TABLE ITEM ADD CONSTRAINT FK_ITEM_2
    FOREIGN KEY (FK_COMPRA_id)
    REFERENCES COMPRA (id)
    ON DELETE RESTRICT;
 
ALTER TABLE COMPRA ADD CONSTRAINT FK_COMPRA_2
    FOREIGN KEY (FK_USUARIO_id)
    REFERENCES USUARIO (id)
    ON DELETE CASCADE;
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_2
    FOREIGN KEY (FK_USUARIO_id)
    REFERENCES USUARIO (id)
    ON DELETE RESTRICT;
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_3
    FOREIGN KEY (FK_TIPO_CONT_id)
    REFERENCES TIPO_CONT (id)
    ON DELETE RESTRICT;
 
ALTER TABLE COMENTARIO ADD CONSTRAINT FK_COMENTARIO_2
    FOREIGN KEY (FK_USUARIO_id)
    REFERENCES USUARIO (id)
    ON DELETE CASCADE;
 
ALTER TABLE COMENTARIO ADD CONSTRAINT FK_COMENTARIO_3
    FOREIGN KEY (FK_PRODUTO_id)
    REFERENCES PRODUTO (id)
    ON DELETE CASCADE;
 
ALTER TABLE prod_restricao ADD CONSTRAINT FK_prod_restricao_1
    FOREIGN KEY (fk_RESTRICAO_id)
    REFERENCES RESTRICAO (id)
    ON DELETE RESTRICT;
 
ALTER TABLE prod_restricao ADD CONSTRAINT FK_prod_restricao_2
    FOREIGN KEY (fk_PRODUTO_id)
    REFERENCES PRODUTO (id)
    ON DELETE RESTRICT;
 
ALTER TABLE item_prod ADD CONSTRAINT FK_item_prod_1
    FOREIGN KEY (fk_PRODUTO_id)
    REFERENCES PRODUTO (id)
    ON DELETE RESTRICT;
 
ALTER TABLE item_prod ADD CONSTRAINT FK_item_prod_2
    FOREIGN KEY (fk_ITEM_id)
    REFERENCES ITEM (id)
    ON DELETE SET NULL;
